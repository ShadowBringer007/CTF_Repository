# Stonks WriteUp

When reading the challenge, it gives the source code to look for the vulnerability. As well as a port to connect to a server.</br>
First, looking at the server we are presented with 2 options, to Buy or View.</br>
![image](https://github.com/ShadowBringer007/CTF_Repository/assets/47370367/9e4b2019-88a5-4f51-a029-ba4eaba0d265)</br></br>

When checking out the 2 options Buy presents a user input while View gives no input.</br>
![image](https://github.com/ShadowBringer007/CTF_Repository/assets/47370367/8f40f561-9112-4eeb-b4ee-e5cf4f4a43ef)</br></br>

Now looking at the source code for some sort of function for buying stocks as it has a user input and something we can manipulate. The source code has a "buy_stocks" function to as a target.</br>
![image](https://github.com/ShadowBringer007/CTF_Repository/assets/47370367/47c30018-5e66-4c8d-a15e-b7044eed549c)</br></br>

In the function, the flag seems to be loaded into the memory stack and theres a printf() function which has a string format vulnerabilities.</br>
![image](https://github.com/ShadowBringer007/CTF_Repository/assets/47370367/4634defc-80fe-49fa-ac70-10068b1f9b18)</br>
![image](https://github.com/ShadowBringer007/CTF_Repository/assets/47370367/13dcf3ba-6e1f-452e-9337-db75de1ee4f0)</br></br>

With this knowledge, we can place two type formats to pull data off the stack (%p) for addresses and (%x) for hexidecimal data. In this case we want to pull hexidecimal data off the stack as it will hold information which we can interpret. And if I throw enough %x's then it will reach the area of the stack where the flag is stored.</br>
![image](https://github.com/ShadowBringer007/CTF_Repository/assets/47370367/d6cf24b1-25c2-421c-8d1f-aed93c359b5e)</br></br>

With this hex data we can convert it and hopefully a semblance of a flag will show and it looks it does but this may not happen every time as the values on the stack can change after every run. If a semblance of flag does not show up then remove hex from the beginning of the string until it does. Hex values will alter the entire string.</br>
![image](https://github.com/ShadowBringer007/CTF_Repository/assets/47370367/d43b5cfe-e00d-40f1-9150-79d4a241cc0b)</br></br>

To handle the reversing of 4 hex bytes, as popping values from the stack will be backwards, using the swap endianness from cyberchef. If the flag doesn't reverse, keep removing hex values from the beginning of the string until flag presents itself.</br> 
![image](https://github.com/ShadowBringer007/CTF_Repository/assets/47370367/52b352bd-01cf-4d6a-b23d-d8a8d65c5679)






